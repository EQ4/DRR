<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>About Indycast - </title>
  <style type="text/css">code{white-space: pre;}</style>
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'>
  <style>
  * { font-family: 'Lora', serif; }
  p {
    width: 700px;
    margin-left: 10px;
    line-height: 1.4em;
  }
  h1,h2,h3,h4,h5,h6 {
    color: #002244;
  }
  h2 {
    margin-left: 10px;
  }
  h3 {
    margin-left: 20px;
  }
  h4 {
    margin-left: 40px;
  }
  
  h2 ~ p {
    margin-left: 20px;
  }
  h3 ~ table, h3 ~ p,h3 ~ ul, h3 ~ pre {
    margin-left: 40px;
  }
  th,td {
    padding-right: 12px;
  }
  li {
    line-height: 1.3em
  }
  code, pre{
    font-family: 'Inconsolata', monospace;
  }
  pre {
    display: inline-block;
    line-height: 1.5em;
    width: auto;
    background: #f8fafd;
    box-shadow: 0 0 2px 0px #ddd inset;
    padding: 0.75em 1em;
    border-radius: 5px;
    margin: 0 1em;
  }
  code {
    text-shadow: 0px 0px 1px #aaa;
  }
  pre > code {
    text-shadow: 0 0;
  }
  blockquote {
    border-left: 4px solid #eef;
  }
  </style>
</head>
<body>
<h1 id="introduction">Introduction</h1>
<p>Indycast is a set of federated servers controlled by a community for time-shifting independent radio.</p>
<p>I've been a listener and supporter of non-commercial radio for about 20 years.</p>
<p>In that time, I've found a few things:</p>
<ul>
<li>Often the best shows are on at inconvenient hours</li>
<li>These shows are rarely archived</li>
<li>When the shows are archived, they have the following properties
<ul>
<li>I often need itunes, which I don't have</li>
<li>They break the show down into small units that must be reconstituted manually</li>
<li>You have to know every show and stations individual site</li>
<li>The retention policy of the audio and when it is availabe widely varies</li>
</ul></li>
</ul>
<p>However, they all have internet streams that you can listen to wherever.</p>
<h3 id="version-1-circa-2010">Version 1: circa 2010</h3>
<p>So a few years ago I made a shell-scripted solution for this. cron would fire off a downloader at the time my show was on, the downloader would time-stamp the web stream and dump it in a directory and then I can listen to it later.</p>
<p>This worked fine. For years actually. But it was so useful I wanted to share this with everyone.</p>
<p>So I had to make a system that everyone could use.</p>
<h2 id="designing-something-for-everyone">Designing something for everyone</h2>
<p>I made a few decisions to set up the framework of the system early on:</p>
<ul>
<li><strong>Non-commercial:</strong> I wanted a way to support and provide listener supported radio in a convenient manner</li>
<li><strong>Free:</strong> Although I'm just building a platform, it didn't feel right charging people for this so it had to be free</li>
<li><strong>Distributed:</strong> The architecture has to allow people from other places with their own stations to join the network without much effort</li>
<li><strong>Hackable:</strong> Every device and reasonable way of listening to content should be supported</li>
</ul>
<h2 id="architecture">Architecture</h2>
<p>Since there's no money behind this, that means that I'd need a way to do this cheaply and in a way that has a really low barrier to entry for participation. I want to encourage people to run and manage their own servers for their favorite radio station.</p>
<p>Here were my priorities, the solution should be:</p>
<ul>
<li>easy and quick to setup.</li>
<li>a small-footprint, unobtrusive system that can piggy-back on servers doing other things.</li>
<li>highly configurable with reasonable defaults.</li>
<li>able to be disk and network effecient.</li>
<li>able to be run multiple times on the same machine for different stations.</li>
</ul>
<p>It also should not</p>
<ul>
<li>require significant dependencies</li>
<li>be language-specific with arcane knowledge needed in order to get it running.</li>
</ul>
<p>So the stack chosen was Python 2.7, Flask, and SQLite 3. The audio library was written by hand.</p>
<h2 id="user-experience">User-experience</h2>
<h3 id="administrator">Administrator</h3>
<p>I envisioned the ideal user-experience of someone who wants to participate in this:</p>
<h4 id="easy-set-up">Easy set-up</h4>
<p>Alice, a junior dev, is interested in adding her station, RDIO. She</p>
<ul>
<li>git clones the repository</li>
<li>runs a small shell script to install dependencies</li>
<li>goes to RDIO's website and finds the live stream url</li>
<li>puts the url in a configuration file, say rdio.txt</li>
<li>runs the server with this configuration file.</li>
</ul>
<h4 id="self-contained">Self-contained</h4>
<p>When the server starts up, it</p>
<ul>
<li>puts everything in a single directory with a simple to understand hierarchy</li>
<li>forks processes from a manager thread, carefully naming them with their purpose</li>
<li>has an informative log file that tells the user what's going on</li>
<li>is easy to shut down and restart</li>
<li>is remotely upgradable, replacing its own footprint seamlessly</li>
</ul>
<h4 id="non-mysterious">Non-mysterious</h4>
<p>There's an endpoint map so that the admin can see everything that is accessible along with its documentation. For instance</p>
<pre><code>$ curl indycast.net/kpcc/site-map
/heartbeat      
    A low resource version of the /stats call ... this is invoked
    by the server health check.  Only the uptime of the server is reported.
    
    This allows us to check if a restart happened between invocations.
    

/site-map        
    Shows all the end points supported by the current server, the options 
    and the documentation.
    

/reindex         
    Starts the prune process which cleans up and offloads audio files but also re-index 
    the database.

    This is useful in the cases where bugs have led to improper registration of the 
    streams and a busted building of the database.  It&#39;s fairly expensive in I/O costs 
    so this shouldn&#39;t be done as the default.
    

/restart         
    Restarts an instance. This does so in a gapless non-overlapping way.
    

/upgrade        
    Goes to the source directory, pulls down the latest from git
    and if the versions are different, the application restarts.
    

/prune           
    Starts the prune sub-process which cleans up and offloads audio files 
    following the rules outlined in the configuration file (viewable with the stats call)
    

/stats           
    Reports various statistical metrics on a particular server.  
    Use this with the graph.py tool to see station coverage.
    

/uuid            
    Returns this server&#39;s uuid which is generated each time it is run.
    This is used to determine whether this is the official server or not.
    

/db              
    Backs up the current sqlite3 db and sends a gzipped version of it as the response.
    

/[weekday]/[start]/[duration_string]/[showname] 
    Returns a podcast xml file based on the weekday, start and duration.
    This is designed to be read by podcasting software such as podkicker, 
    itunes, and feedburner.

    weekdays are defined as mon, tue, wed, thu, fri, sat, sun.

    If a show occurs multiple times per week, this can be specified with
    a comma.  for instance,

    /mon,tue,fri/4pm/1hr
    
    The showname should be followed by an &quot;xml&quot; extension.

    It should also be viewable in a modern web browser.

    If you can find a podcaster that&#39;s not supported, please send an email 
    to indycast@googlegroups.com.
    

/at/[start]/[duration_string] 
    Sends a stream using a human-readable (and human-writable) definition 
    at start time.  This uses the dateutils.parser library and so strings 
    such as &quot;Monday 2pm&quot; are accepted.

    Because the space, 0x20 is such a pain in HTTP, you can use &quot;_&quot;, 
    &quot;-&quot; or &quot;+&quot; to signify it.  For instance,

        /at/monday_2pm/1hr

    Will work fine
    

/slices/[path] 
    Downloads a stream from the server. The path is callsign-date_duration.mp3

      * callsign: The callsign returned by /stats
      * date: in the format YYYYMMDDHHMM such as 201508011005 for 
        2015-08-01 10:05
      * duration: A value, in minutes, to return.

    The mp3 extension should be used regardless of the actual format of the stream -
    although the audio returned will be in the streams&#39; native format.
    
    The streams are created and sent on-demand, so there may be a slight delay before
    it starts.
    

/live/[start]  
    Sends off a live-stream equivalent.  Two formats are supported:

     * duration - In the form of strings such as &quot;1pm&quot; or &quot;2:30pm&quot;
     * offset - starting with a negative &quot;-&quot;, this means &quot;from the present&quot;.
        For instance, to start the stream from 5 minutes ago, you can do &quot;-5&quot;</code></pre>
<p>These can be queried using a server query tool, located in <code>tools/server_query.py</code>. It can query any endpoint on any number of stations and parse JSON if desired. For instance, if I wanted to see how much disk space kpcc is using I can do the following:</p>
<pre><code>$ tools/server_query.py -k disk -c kpcc
{&quot;url&quot;: &quot;kpcc.indycast.net:8930&quot;, &quot;latency&quot;: 2.824465036392212, &quot;disk&quot;: 2000112}</code></pre>
<p>Or, what if I wanted to find out the uptime and disk space of kpcc and kxlu?</p>
<pre><code>$ tools/server_query.py -k disk,uptime -c kpcc,kxlu
[
{&quot;url&quot;: &quot;kxlu.indycast.net:8890&quot;, &quot;latency&quot;: 3.542130947113037, &quot;uptime&quot;: 5235, &quot;disk&quot;: 2283312},
{&quot;url&quot;: &quot;kpcc.indycast.net:8930&quot;, &quot;latency&quot;: 2.451361894607544, &quot;uptime&quot;: 5250, &quot;disk&quot;: 2000112}
]</code></pre>
<p>As you can see, the server query presents this in a JSON array for our convenience.</p>
<p>If you'd like to find out what the station coverage is, there's a graph-drawing tool that tells you.</p>
<pre><code>$ tools/server_query.py -q stats -c kpcc | tools/graph.py 

         +-0---1---2---3---4---5---6---7---8---9---10--11--12--13--14--15--16--17--18--19--20--21--22--23--+
2015-07-06 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . |
2015-07-07 *=******.*********************************************.**************************************** |
2015-07-08 ************************************************* **********************************************|
2015-07-09 .***********************************.********************************************************** |
2015-07-10 ******************************************************* *******=******************************* |
2015-07-11 **************.**************** .*********************************.**************************** |
2015-07-12 ***************** *********************************************************************** ******|
2015-07-13 .********************** ***********************************=****************.*******************|
2015-07-14 .***************.*****************.******** ****************************************************|
2015-07-15 .***********************************************************************************************|
2015-07-16 . *********=********************=*******************=**********************************=********|
2015-07-17 .************** ***** ********************************************************* ******* ******* |
2015-07-18 *********************************************** ****************. . . . . . . . . . .***********|
2015-07-19 .***********************************************************************************************|
2015-07-20 .***********************************************************************************************|
2015-07-21 .***********************************************************************************************|
2015-07-22 .***********************.***********************************************.********************** |
2015-07-23 .****************************************************************============*************.** **|
2015-07-24 ************************************************************************====. . . . . . . ******|
2015-07-25 .***.**** ***************************** *************** .******************** ************.*****|
2015-07-26 .*********************************************************************.************ ********.***|
2015-07-27 .****==== ******************************* **********************.*********.*************.*******|
2015-07-28 .****** *************************** *********************** *********************************** |
2015-07-29 ***************************************************======*************===************ ********* |
2015-07-30 ************* ******************************=========*******.****** .*.************************ |
2015-07-31 .************************************************** ******************.************************ |
2015-08-01 *********************************************************************************************=* |
2015-08-02 **=*************************==************* .**** ********************************************* |
2015-08-03 *** ***** *********************************** ********* ******.** *** *******=======*********** |
2015-08-04 ********.**************************************************** . . . . . . . . . . . . . . . . . |
         +-0---1---2---3---4---5---6---7---8---9---10--11--12--13--14--15--16--17--18--19--20--21--22--23--+

         kpcc coverage: 90.877315%</code></pre>
<h3 id="user">User</h3>
<p>The user of the service should be able to use the service in any reasonable way with any reasonable set of expectations.</p>
<h4 id="subscribe-to-any-time-slot">Subscribe to any time slot</h4>
<p>This should be accessible with a simple url schema:</p>
<pre><code>http://indycast.net/[station]/[weekday,...]/[start time]/[duration]/[name]</code></pre>
<p>For instance, if there's a 2 hour show called, say &quot;Darkwaves&quot; at 2AM monday and wednesday mornings, you could do:</p>
<pre><code>http://indycast.net/rdio/mon,wed/2am/2hr/Darkwaves.xml</code></pre>
<p>And that url should be openable in anything that ostensibly accepts &quot;podcasts&quot;.</p>
<h4 id="listen-to-live-radio-with-a-delay">Listen to live radio with a delay</h4>
<p>Alice turns on her radio and there's a fascinating interview going on. Unfortunately, she missed the beginning of it. She should be able to listen to RDIO starting say, 5 minutes ago, by doing the following:</p>
<pre><code>http://indycast.net/rdio/live/-5min</code></pre>
<p>Or, if she wanted to listen starting at 1pm, this should work:</p>
<pre><code>http://indycast.net/rdio/live/1pm</code></pre>
<h4 id="pick-any-arbitrary-time-slice">Pick any arbitrary time slice</h4>
<p>If Alice just wants to listen to say, the Darkwaves show directly, from the command line, without all the hassle, she should be able to specify a date, time, and duration, such as this:</p>
<pre><code>$ mplayer http://indycast.net/rdio/at/monday_2am/2hr</code></pre>
<h4 id="should-be-usable-by-novices">Should be usable by novices</h4>
<p>If Alice doesn't really know how to use computers that well, there should be a <a href="http://indycast.net">web front end</a> that explains what this is and has a simple and attractive user-interface that she can operate on the device of her choosing.</p>
</body>
</html>
